import{d as R}from"./main-DnzRc55b.js";const M=n=>{let t;const e=new Set,a=(l,p)=>{const m=typeof l=="function"?l(t):l;if(!Object.is(m,t)){const k=t;t=p??(typeof m!="object"||m===null)?m:Object.assign({},t,m),e.forEach(f=>f(t,k))}},r=()=>t,i={setState:a,getState:r,getInitialState:()=>u,subscribe:l=>(e.add(l),()=>e.delete(l))},u=t=n(a,r,i);return i},$=(n=>n?M(n):M),E=n=>n;function P(n,t=E){const e=R.useSyncExternalStore(n.subscribe,R.useCallback(()=>t(n.getState()),[n,t]),R.useCallback(()=>t(n.getInitialState()),[n,t]));return R.useDebugValue(e),e}const q=n=>{const t=$(n),e=a=>P(t,a);return Object.assign(e,t),e},F=(n=>n?q(n):q);function _(n,t){let e;try{e=n()}catch{return}return{getItem:r=>{var s;const d=u=>u===null?null:JSON.parse(u,void 0),i=(s=e.getItem(r))!=null?s:null;return i instanceof Promise?i.then(d):d(i)},setItem:(r,s)=>e.setItem(r,JSON.stringify(s,void 0)),removeItem:r=>e.removeItem(r)}}const C=n=>t=>{try{const e=n(t);return e instanceof Promise?e:{then(a){return C(a)(e)},catch(a){return this}}}catch(e){return{then(a){return this},catch(a){return C(a)(e)}}}},j=(n,t)=>(e,a,r)=>{let s={storage:_(()=>localStorage),partialize:o=>o,version:0,merge:(o,y)=>({...y,...o}),...t},d=!1;const i=new Set,u=new Set;let l=s.storage;if(!l)return n((...o)=>{console.warn(`[zustand persist middleware] Unable to update item '${s.name}', the given storage is currently unavailable.`),e(...o)},a,r);const p=()=>{const o=s.partialize({...a()});return l.setItem(s.name,{state:o,version:s.version})},m=r.setState;r.setState=(o,y)=>(m(o,y),p());const k=n((...o)=>(e(...o),p()),a,r);r.getInitialState=()=>k;let f;const S=()=>{var o,y;if(!l)return;d=!1,i.forEach(g=>{var c;return g((c=a())!=null?c:k)});const v=((y=s.onRehydrateStorage)==null?void 0:y.call(s,(o=a())!=null?o:k))||void 0;return C(l.getItem.bind(l))(s.name).then(g=>{if(g)if(typeof g.version=="number"&&g.version!==s.version){if(s.migrate){const c=s.migrate(g.state,g.version);return c instanceof Promise?c.then(h=>[!0,h]):[!0,c]}console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return[!1,g.state];return[!1,void 0]}).then(g=>{var c;const[h,I]=g;if(f=s.merge(I,(c=a())!=null?c:k),e(f,!0),h)return p()}).then(()=>{v?.(f,void 0),f=a(),d=!0,u.forEach(g=>g(f))}).catch(g=>{v?.(void 0,g)})};return r.persist={setOptions:o=>{s={...s,...o},o.storage&&(l=o.storage)},clearStorage:()=>{l?.removeItem(s.name)},getOptions:()=>s,rehydrate:()=>S(),hasHydrated:()=>d,onHydrate:o=>(i.add(o),()=>{i.delete(o)}),onFinishHydration:o=>(u.add(o),()=>{u.delete(o)})},s.skipHydration||S(),f||k},U=j,w=n=>Math.floor(100*Math.pow(1.5,n-1)),L=n=>{let t=1,e=0;for(;e+w(t)<=n;)e+=w(t),t++;return t},W={1:"Seeker",5:"Disciple",10:"Scholar",15:"Devoted",20:"Faithful",25:"Sage",30:"Elder",35:"Prophet",40:"Apostle",45:"Saint",50:"Illuminated"},G=n=>Object.entries(W).filter(([e])=>parseInt(e)<=n).sort(([e],[a])=>parseInt(a)-parseInt(e))[0]?.[1]||"Seeker",H=[{id:"streak-7",name:"Week Warrior",description:"Maintain a 7-day reading streak",icon:"ðŸ”¥",unlocked:!1,unlockedDate:null,requirement:7,type:"streak"},{id:"streak-30",name:"Monthly Devotion",description:"Maintain a 30-day reading streak",icon:"âš¡",unlocked:!1,unlockedDate:null,requirement:30,type:"streak"},{id:"streak-100",name:"Century Mark",description:"Maintain a 100-day reading streak",icon:"ðŸ’Ž",unlocked:!1,unlockedDate:null,requirement:100,type:"streak"},{id:"streak-365",name:"Year of Faith",description:"Maintain a 365-day reading streak",icon:"ðŸ‘‘",unlocked:!1,unlockedDate:null,requirement:365,type:"streak"},{id:"readings-1",name:"First Light",description:"Complete your first reading",icon:"ðŸŒ…",unlocked:!1,unlockedDate:null,requirement:1,type:"readings"},{id:"readings-100",name:"Centurion",description:"Complete 100 readings",icon:"ðŸ“–",unlocked:!1,unlockedDate:null,requirement:100,type:"readings"},{id:"readings-500",name:"Bibliophile",description:"Complete 500 readings",icon:"ðŸ“š",unlocked:!1,unlockedDate:null,requirement:500,type:"readings"},{id:"readings-1000",name:"Scripture Master",description:"Complete 1000 readings",icon:"ðŸ†",unlocked:!1,unlockedDate:null,requirement:1e3,type:"readings"},{id:"level-5",name:"Disciple",description:"Reach level 5",icon:"â­",unlocked:!1,unlockedDate:null,requirement:5,type:"level"},{id:"level-10",name:"Scholar",description:"Reach level 10",icon:"ðŸŒŸ",unlocked:!1,unlockedDate:null,requirement:10,type:"level"},{id:"level-25",name:"Sage",description:"Reach level 25",icon:"âœ¨",unlocked:!1,unlockedDate:null,requirement:25,type:"level"},{id:"level-50",name:"Illuminated",description:"Reach level 50",icon:"ðŸŒ ",unlocked:!1,unlockedDate:null,requirement:50,type:"level"},{id:"perfect-day",name:"Perfect Day",description:"Complete all 4 readings in a single day",icon:"ðŸŽ¯",unlocked:!1,unlockedDate:null,requirement:4,type:"special"},{id:"month-complete",name:"Chapter Closed",description:"Complete an entire month of readings",icon:"ðŸ“…",unlocked:!1,unlockedDate:null,requirement:25,type:"special"}],K=()=>new Date().toISOString().split("T")[0],x=3,D=()=>{const n=new Date,t=n.getMonth()+1,e=n.getDate();return e<=25?{month:t,day:e,isCatchUpDay:!1}:{month:t,day:25,isCatchUpDay:!0}},N=n=>{const t=new Date;t.setDate(t.getDate()+n);const e=t.getMonth()+1,a=Math.min(t.getDate(),25);return{month:e,day:a}},b=n=>{for(let t=0;t<x;t++){const{month:e,day:a}=N(-t);if(n===`${e}-${a}`)return!0}return!1},A=()=>{const n=new Date,t=n.getDay(),e=n.getDate()-t+(t===0?-6:1);return new Date(n.setDate(e)).toISOString().split("T")[0]},T=()=>{const{month:n,day:t,isCatchUpDay:e}=D();return{currentMonth:n,currentDay:t,isCatchUpDay:e}},O={completedReadings:{},streak:{current:0,longest:0,lastReadDate:null,freezesRemaining:0,freezeUsedThisWeek:!1,weekStartDate:A()},xp:{total:0,level:1,todayEarned:0,lastEarnedDate:null},achievements:H,settings:T()},J=F()(U((n,t)=>({...O,completeReading:(e,a)=>{const r=t(),{month:s,day:d}=D(),i=`${s}-${d}`,u=a||i;if(!b(u)){console.warn("Cannot complete readings outside the 3-day grace period");return}const l=r.completedReadings[u]||[];if(l.includes(e))return;const p={...r.completedReadings,[u]:[...l,e]};let m=10;const k=p[u].length;k===4&&(m+=50),r.streak.current>0&&(m+=Math.min(r.streak.current*5,100));const f=r.xp.total+m,S=L(f);let o={...r.streak};const y=K();if(r.streak.lastReadDate===null)o.current=1,o.lastReadDate=y;else if(r.streak.lastReadDate!==y){const c=new Date(r.streak.lastReadDate),h=new Date(y);Math.floor((h.getTime()-c.getTime())/(1e3*60*60*24))<=x?(o.current=r.streak.current+1,o.lastReadDate=y):(o.current=1,o.lastReadDate=y)}o.longest=Math.max(o.longest,o.current);const v=Object.values(p).flat().length,g=r.achievements.map(c=>{if(c.unlocked)return c;let h=!1;switch(c.type){case"streak":h=o.current>=c.requirement;break;case"readings":h=v>=c.requirement;break;case"level":h=S>=c.requirement;break;case"special":c.id==="perfect-day"&&(h=k>=4);break}return h?{...c,unlocked:!0,unlockedDate:y}:c});n({completedReadings:p,streak:o,xp:{total:f,level:S,todayEarned:r.xp.lastEarnedDate===y?r.xp.todayEarned+m:m,lastEarnedDate:y},achievements:g})},uncompleteReading:(e,a)=>{const{month:r,day:s}=D(),d=`${r}-${s}`,i=a||d;if(!b(i))return;const u=t(),p=(u.completedReadings[i]||[]).filter(m=>m!==e);n({completedReadings:{...u.completedReadings,[i]:p}})},useStreakFreeze:()=>!1,updateSettings:e=>{n(a=>({settings:{...a.settings,...e}}))},navigateDay:e=>{const a=t(),{month:r,day:s}=D();let{currentMonth:d,currentDay:i}=a.settings;if(e==="next"){const u=i<25?i+1:1,l=i<25?d:d===12?1:d+1;if(l>r||l===r&&u>s)return;i=u,d=l}else i>1?i--:(i=25,d=d===1?12:d-1);n({settings:{...a.settings,currentMonth:d,currentDay:i,isCatchUpDay:!1}})},resetProgress:()=>{n({...O,settings:T()})},getTodayReadings:()=>{const{month:e,day:a}=D(),r=`${e}-${a}`;return t().completedReadings[r]||[]},getCompletedCount:()=>{const e=t();return Object.values(e.completedReadings).flat().length},getCurrentDayKey:()=>{const e=t();return`${e.settings.currentMonth}-${e.settings.currentDay}`},canCompleteReading:(e,a)=>b(a)?(t().completedReadings[a]||[]).length>=e:!1,isViewingToday:()=>{const e=t(),{month:a,day:r}=D();return e.settings.currentMonth===a&&e.settings.currentDay===r},isViewingWithinGracePeriod:()=>{const e=t(),a=`${e.settings.currentMonth}-${e.settings.currentDay}`;return b(a)},syncToToday:()=>{const{month:e,day:a,isCatchUpDay:r}=D();n(s=>({settings:{...s.settings,currentMonth:e,currentDay:a,isCatchUpDay:r}}))}}),{name:"bible-tracker-storage"})),X=(n,t)=>{let e=0;for(let s=1;s<t;s++)e+=w(s);const a=n-e,r=w(t);return{current:a,required:r,percentage:a/r*100}};export{X as a,G as g,J as u};
